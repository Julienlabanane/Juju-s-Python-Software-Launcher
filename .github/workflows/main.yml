
name: Build Python App


on:
  push:
    branches:
      - main
  workflow_dispatch:


jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: 3.11
      - name: Upgrade pip and install pyinstaller
        run: python -m pip install --upgrade pip pyinstaller
      - name: Build executable with PyInstaller
        run: pyinstaller --onefile main.py --add-data "ETC/451config.xml;ETC" --add-data "LOG;LOG" --add-data "LOCAL;LOCAL"
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: windows-build
          path: dist/

  build-linux:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: 3.11
      - name: Upgrade pip and install pyinstaller
        run: python -m pip install --upgrade pip pyinstaller
      - name: Build executable with PyInstaller
        run: pyinstaller --onefile main.py --add-data "ETC/451config.xml:ETC" --add-data "LOG:LOG" --add-data "LOCAL:LOCAL"
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: linux-build
          path: dist/

  build-macos:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: 3.11
      - name: Upgrade pip and install pyinstaller
        run: python -m pip install --upgrade pip pyinstaller
      - name: Build executable with PyInstaller
        run: pyinstaller --onefile main.py --add-data "ETC/451config.xml:ETC" --add-data "LOG:LOG" --add-data "LOCAL:LOCAL"
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: macos-build
          path: dist/

  build-freebsd:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/vmactions/freebsd-vm:latest
    steps:
      - uses: actions/checkout@v3
      - name: Install Python and PyInstaller
        run: |
          pkg install -y python311 py39-pip
          python3.11 -m pip install --upgrade pip pyinstaller
      - name: Build executable with PyInstaller
        run: python3.11 -m PyInstaller --onefile main.py --add-data "ETC/451config.xml:ETC" --add-data "LOG:LOG" --add-data "LOCAL:LOCAL"
      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: freebsd-build
          path: dist/

